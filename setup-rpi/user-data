#cloud-config
hostname: pi-new

users:
  - name: system
    groups: [sudo]
    passwd: '$6$8PEvvahRpEB.dhjw$VDYblGK0JfAMED9aLSFQu4BEkqZ4LO44ZWbpjwd2wrQLFgTbHj0P7ZQ9sWxAEQ51lvvmJNNb8Ud1OfhATen6N0'
    lock_passwd: false
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash

package_update: true
packages:
  - make
  - git

runcmd:
  - |
    # Wait for network connectivity
    until ping -c 1 8.8.8.8 >/dev/null 2>&1; do
      echo "Waiting for network..."
      sleep 5
    done
    echo "Network is ready"
    
    # Clone repo and run make setup
    cd /home/system
    mkdir -p wip
    cd wip
    git clone https://github.com/jgumbley/setup-system.git
    cd setup-system
    chown -R system:system /home/system